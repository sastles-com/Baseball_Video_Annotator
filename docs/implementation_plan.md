# ビデオ注釈ツール（Video Annotation Tool） 実装計画

本計画は、野球の試合映像を1球ごとに分割し、球種や状況などのタグ付けを行って後からフィルタリング可能にするためのツールの実装について定義します。AWSへの展開や過去の運用経験を踏まえ、**React + FastAPI** をベースとしたWebアプリケーションとして構築します。

## アーキテクチャ

AWS上での運用やタグデータの履歴管理を見据え、フロントエンドとバックエンドを分離した構成とします。

- **フロントエンド:** React (Vite), TypeScript, Tailwind CSS
  - Reactは状態管理（現在の再生位置、栞、チャンク、タグなど）や複雑なUI（スライダー、コンテキストメニュー）の構築に非常に適しており、動画のシーク制御（スライダーやマスウホイール）も柔軟に実装可能です。
  - アイコン群には Lucide React を採用します。
- **バックエンド:** Python (FastAPI)
  - APIサーバーとして機能し、動画ファイルのアップロード・配信、および「過去につけたタグの履歴（サジェスト用）」や「タグ付け結果（JSON）」のデータベース（またはファイル）への保存などを担当します。

## 実装される機能（要件の網羅）

### 1. 動画再生と精密コントロール
- **ローカル/サーバー動画読み込み:** アップロードまたはサーバー上の動画ファイル（mp4等）をブラウザ上で再生します。
- **カスタムスライダー:** 任意の再生位置へのシークを実現します。
- **マウスホイール再生（スクラブ）:** 動画プレイヤー上でマウスホイールを回転させることで、動画をコマ送り・コマ戻し（または数秒スキップ）する直感的なシークを実現します。
- **ショートカットキー:** 再生/一時停止、栞の挿入、シークなどの操作をキーボードショートカットで実行可能にします。

### 2. 栞（ブックマーク）とチャンク生成
- **1球ごとの分割:** タイムライン上やショートカットキー、右クリックメニューから任意のタイミングで栞を挿入し、動画をチャンク（1球などの単位）に分割します。
- チャンクをクリックすることで、その開始位置にシークする機能を持ちます。

### 3. 多階層のタグ付け機能
野球の試合を分析するための柔軟なタグ構成を提供します。
- **動画全体のタグ（メタデータ）:** 「エネオス対日産自動車」「ピッチャー名」など、動画全体にかかわる情報。
- **特定範囲・グループのタグ:** 「3回表 日産の攻撃」など、複数のチャンクをまたぐイニング・状況タグ。
- **チャンク（1球）ごとのタグ:** 球種、コース、結果（ストライク、ボール、ヒット）などの詳細タグ。
- **右クリックメニュー:** タイムラインや動画領域で右クリックすることで、素早くタグや栞を付与できるコンテキストメニューを提供します。

### 4. タグの統一と履歴管理（誤字揺れ防止）
- **定型タグのプリセット:** 予め用意したJSONファイル（タグの雛形）を読み込み、固定のタグリストとして利用できるようにします。
- **履歴サジェスト:** 過去に入力されたタグの履歴をバックエンド（またはローカルストレージ）で管理し、タグ入力時にサジェスト（選択肢として表示）されるようにします。これにより、表記揺れを防ぎます。

### 5. データ保存
- 付与した情報をJSONで保存（ダウンロード機能、およびバックエンドAPIを通じたサーバー側への保存）。

## 開発ステップ

1. **環境構築 (React + FastAPI)**
   - フロントエンド（React/Vite）およびバックエンド（FastAPI）のプロジェクト初期化。
2. **フロントエンド：コアUIの実装**
   - 動画プレイヤー、カスタムスライダ、マウスホイールスクラブ機能の実装。
3. **フロントエンド：栞・チャンク・ショートカット・右クリックメニュー**
   - 状態管理（Zustand または React Context）の構築、およびキーボード/マウス操作フックの実装。
4. **フロントエンド・バックエンド：階層的タグ付けと履歴サジェスト**
   - UI（動画全体、イニング、1球ごと）の作成。
   - JSONファイルからの固定タグリスト読み込み機能機能の実装。
   - FastAPI 側でタグ履歴を返し、React側でオートコンプリートを実装。
5. **連携・永続化の検証**
   - 最終的なJSONの出力フォーマット確認と、全体を通した動作テスト。
