# Graph Visualization Rules (グラフ可視化ルール)

プロジェクト内でのグラフ作成および可視化において、以下のルールを遵守すること。
これにより、実験結果の意図と評価基準が常に明確化され、コミュニケーションロスを防ぐ。

## 1. 必須メタデータ (Required Metadata)

- 全てのグラフはplotlyで作成されること
- plotlyのグラフは必ずhtmlファイルとして出力して，以下の5つのメタデータを付与し、HTMLファイル内に埋め込むこと。

### 🏷️ 要約タイトル (Summary Title)
- **Concise Title**: このグラフの結果を一言で表すタイトル。分析レポートの最上段に配置する。
- 例: 「ベクトルACOによる円柱周りの流場再構成の成功」

### 🎯 目的 (Purpose)
- **What & Why**: このグラフは何を描画しているのか？ なぜこのグラフが必要なのか？
- なぜこのグラフを描くことになったのか？
- 例: 「修正したベクトル抽出アルゴリズムが、停滞点付近の微小移動を正しく捉えているか確認するため。」

### 🔭 期待 (Expectation)
- **Expected Outcome**: 理論や仮説に基づき、どのような結果が期待されるか？
- 例: 「真の速度場（左図）と予測場（右図）の矢印の向きが一致し、特に渦の中心部でベクトルが消失していないこと。」

### 🧐 評価 (Evaluation Criteria)
- **Success Metrics**: グラフのどの部分を見て、どのように良し悪しを判断するのか？
- 例: 「重ね合わせ図（右端）において、黒い矢印（真値）と赤い矢印（予測）の角度差が小さく、L2誤差が 0.5 以下であれば成功とみなす。」
- 「どうなると良いのか？」　例：分布のピークが0に近づくほど分散が小さくなるので良い

### ✨ 結果のハイライト (Highlights)
- **Key Findings**: グラフから読み取れる重要な数値的成果や発見を箇条書きで簡潔にまとめる。
- 例:
    - 「粒子数5000で誤差が収束」
    - 「ノイズ50%環境下でも相関係数0.9以上を維持」


---

## 2. 実装方法 (Implementation)

`src/utils/visualization.py` に実装された `add_analysis_to_html` 機能を利用する。
プロット関数を呼び出す際に、`analysis` 引数として辞書を渡すこと。

```python
from utils.visualization import plot_error_comparison

plot_error_comparison(
    (vx_true, vy_true),
    (vx_est, vy_est),
    title="修正版アルゴリズムの検証結果",
    analysis={
        "purpose": "探索半径を10.0に拡大した効果を検証する。",
        "expectation": "高速領域（画像周辺部）でのベクトル欠損がなくなり、カバレッジが向上すること。",
        "evaluation": "カバレッジが80%を超え、かつ周辺部の矢印が真値と一致していれば合格。"
    }
)
```

## 3. 不明時の対応

メタデータの内容（特に評価基準）が不明確な場合は、**勝手に判断せず、必ずオーナー（ユーザー）に確認すること。**
「とりあえずグラフだけ出す」ことは禁止とする。
